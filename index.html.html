import React, { useMemo, useState } from "react";
import { ShoppingCart, Leaf, Sparkles, Search, Filter, Trash2, ChevronRight, Info } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Slider } from "@/components/ui/slider";
import { Badge } from "@/components/ui/badge";

// --- Uses REAL Grow a Garden pet names (fan-made UI demo) ---
// Sources you can check: Grow a Garden Wiki / PCGamesN / Beebom tier lists.
// Replace placeholder images with your own artwork or in-game screenshots you have rights to use.

const PETS = [
  { id: 1, name: "Raccoon", rarity: "S", priceUSD: 0.69, priceRobux: 7, img: "https://placehold.co/600x600/png?text=Raccoon" },
  { id: 2, name: "Golden Goose", rarity: "S", priceUSD: 0.79, priceRobux: 8, img: "https://placehold.co/600x600/png?text=Golden+Goose" },
  { id: 3, name: "Kitsune", rarity: "S", priceUSD: 0.79, priceRobux: 8, img: "https://placehold.co/600x600/png?text=Kitsune" },
  { id: 4, name: "Disco Bee", rarity: "S", priceUSD: 0.89, priceRobux: 9, img: "https://placehold.co/600x600/png?text=Disco+Bee" },
  { id: 5, name: "T-Rex", rarity: "S", priceUSD: 0.99, priceRobux: 10, img: "https://placehold.co/600x600/png?text=T-Rex" },
  { id: 6, name: "Spinosaurus", rarity: "S", priceUSD: 0.99, priceRobux: 10, img: "https://placehold.co/600x600/png?text=Spinosaurus" },
  { id: 7, name: "Dragonfly", rarity: "S", priceUSD: 0.79, priceRobux: 8, img: "https://placehold.co/600x600/png?text=Dragonfly" },
  { id: 8, name: "Butterfly", rarity: "S", priceUSD: 0.69, priceRobux: 7, img: "https://placehold.co/600x600/png?text=Butterfly" },
  { id: 9, name: "Blood Hedgehog", rarity: "S", priceUSD: 0.99, priceRobux: 10, img: "https://placehold.co/600x600/png?text=Blood+Hedgehog" },
  { id: 10, name: "Moon Cat", rarity: "S", priceUSD: 0.89, priceRobux: 9, img: "https://placehold.co/600x600/png?text=Moon+Cat" },
  { id: 11, name: "French Fry Ferret", rarity: "S", priceUSD: 0.79, priceRobux: 8, img: "https://placehold.co/600x600/png?text=French+Fry+Ferret" },
  { id: 12, name: "Kappa", rarity: "S", priceUSD: 0.89, priceRobux: 9, img: "https://placehold.co/600x600/png?text=Kappa" },
  { id: 13, name: "Queen Bee", rarity: "A", priceUSD: 0.69, priceRobux: 7, img: "https://placehold.co/600x600/png?text=Queen+Bee" },
  { id: 14, name: "Griffin", rarity: "A", priceUSD: 0.79, priceRobux: 8, img: "https://placehold.co/600x600/png?text=Griffin" },
  { id: 15, name: "Capybara", rarity: "A", priceUSD: 0.69, priceRobux: 7, img: "https://placehold.co/600x600/png?text=Capybara" },
  { id: 16, name: "Pancake Mole", rarity: "A", priceUSD: 0.69, priceRobux: 7, img: "https://placehold.co/600x600/png?text=Pancake+Mole" },
  { id: 17, name: "Mimic Octopus", rarity: "A", priceUSD: 0.79, priceRobux: 8, img: "https://placehold.co/600x600/png?text=Mimic+Octopus" },
  { id: 18, name: "Gorilla Chef", rarity: "A", priceUSD: 0.79, priceRobux: 8, img: "https://placehold.co/600x600/png?text=Gorilla+Chef" },
  { id: 19, name: "Moth", rarity: "A", priceUSD: 0.59, priceRobux: 6, img: "https://placehold.co/600x600/png?text=Moth" },
  { id: 20, name: "Brontosaurus", rarity: "A", priceUSD: 0.79, priceRobux: 8, img: "https://placehold.co/600x600/png?text=Brontosaurus" },
  { id: 21, name: "Ostrich", rarity: "A", priceUSD: 0.69, priceRobux: 7, img: "https://placehold.co/600x600/png?text=Ostrich" },
  { id: 22, name: "Seal", rarity: "A", priceUSD: 0.69, priceRobux: 7, img: "https://placehold.co/600x600/png?text=Seal" },
  { id: 23, name: "Snail", rarity: "A", priceUSD: 0.59, priceRobux: 6, img: "https://placehold.co/600x600/png?text=Snail" },
  { id: 24, name: "Honey Bee", rarity: "A", priceUSD: 0.59, priceRobux: 6, img: "https://placehold.co/600x600/png?text=Honey+Bee" },
  { id: 25, name: "Scarlet Macaw", rarity: "S", priceUSD: 0.99, priceRobux: 10, img: "https://placehold.co/600x600/png?text=Scarlet+Macaw" },
  { id: 26, name: "Chicken Zombie", rarity: "S", priceUSD: 0.99, priceRobux: 10, img: "https://placehold.co/600x600/png?text=Chicken+Zombie" },
  { id: 27, name: "Lobster Thermidor", rarity: "S", priceUSD: 0.99, priceRobux: 10, img: "https://placehold.co/600x600/png?text=Lobster+Thermidor" },
  { id: 28, name: "Raiju", rarity: "S", priceUSD: 0.99, priceRobux: 10, img: "https://placehold.co/600x600/png?text=Raiju" },
  { id: 29, name: "Jandel Monkey", rarity: "Mythic", priceUSD: 1.49, priceRobux: 15, img: "https://placehold.co/600x600/png?text=Jandel+Monkey" }
];

const RARITIES = ["All", "S", "A", "Mythic"] as const;

function formatUsd(n: number) {
  return `$${n.toFixed(2)}`;
}

export default function GrowAGardenPetShopReal() {
  const [query, setQuery] = useState("");
  const [rarity, setRarity] = useState<(typeof RARITIES)[number]>("All");
  const [maxPriceR$, setMaxPriceR$] = useState(15);
  const [sort, setSort] = useState("price-asc");
  const [cart, setCart] = useState<{ id: number; qty: number }[]>([]);
  const [currency, setCurrency] = useState<"R$" | "USD">("R$");

  const filtered = useMemo(() => {
    let list = PETS.filter(p => p.priceRobux <= maxPriceR$);
    if (rarity !== "All") list = list.filter(p => p.rarity === rarity);
    if (query.trim()) list = list.filter(p => p.name.toLowerCase().includes(query.toLowerCase()));
    switch (sort) {
      case "price-desc":
        list.sort((a, b) => a.priceRobux < b.priceRobux ? 1 : -1); break;
      case "name-asc":
        list.sort((a, b) => a.name.localeCompare(b.name)); break;
      case "name-desc":
        list.sort((a, b) => b.name.localeCompare(a.name)); break;
      default:
        list.sort((a, b) => a.priceRobux - b.priceRobux); // price-asc
    }
    return list;
  }, [query, rarity, sort, maxPriceR$]);

  const totalQty = cart.reduce((s, c) => s + c.qty, 0);
  const totalPriceRobux = cart.reduce((s, c) => s + (PETS.find(p => p.id === c.id)?.priceRobux || 0) * c.qty, 0);
  const totalPriceUSD = cart.reduce((s, c) => s + (PETS.find(p => p.id === c.id)?.priceUSD || 0) * c.qty, 0);

  function addToCart(id: number) {
    setCart(prev => {
      const found = prev.find(i => i.id === id);
      if (found) return prev.map(i => i.id === id ? { ...i, qty: i.qty + 1 } : i);
      return [...prev, { id, qty: 1 }];
    });
  }

  function removeFromCart(id: number) {
    setCart(prev => prev.filter(i => i.id !== id));
  }

  function checkout() {
    alert("Demo only — use the in-game trading system. No real-money trading.");
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-emerald-50 via-white to-white">
      {/* Header */}
      <header className="sticky top-0 z-30 backdrop-blur bg-white/70 border-b">
        <div className="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
          <div className="w-9 h-9 rounded-2xl bg-emerald-100 flex items-center justify-center shadow-sm">
            <Leaf className="w-5 h-5" />
          </div>
          <div className="flex-1">
            <h1 className="text-xl font-bold leading-tight">Grow a Garden – Real Pets (Fan Shop UI)</h1>
            <p className="text-xs text-muted-foreground -mt-0.5">Fan-made storefront • Real pet names • Cheap placeholder prices</p>
          </div>

          <div className="hidden md:flex items-center gap-2">
            <Badge variant="secondary" className="rounded-full">Fan Project</Badge>
            <Button variant="outline" size="sm" onClick={() => setCurrency(c => c === "R$" ? "USD" : "R$")}>{currency === "R$" ? "Show USD" : "Show Robux"}</Button>
            <Button variant="default" size="sm" className="gap-2"><ShoppingCart className="w-4 h-4" /> Cart ({totalQty})</Button>
          </div>
        </div>
      </header>

      {/* Announcement / Disclaimer */}
      <div className="border-b bg-emerald-50/60">
        <div className="max-w-7xl mx-auto px-4 py-3 text-sm flex items-start gap-2">
          <Info className="w-4 h-4 mt-0.5 shrink-0" />
          <p className="leading-snug">
            This is a <span className="font-medium">fan-made demo</span> for <span className="font-medium">Grow a Garden</span> by Jandel. Not affiliated with or endorsed by Roblox or Jandel. <span className="font-medium">No real-money trading.</span> Prices are placeholders for UI testing. To get pets, use in-game eggs, events, or the official trading system and follow Roblox Terms of Use.
          </p>
        </div>
      </div>

      {/* Controls */}
      <section className="max-w-7xl mx-auto px-4 py-6 grid gap-4 md:grid-cols-12">
        <Card className="md:col-span-5 lg:col-span-6">
          <CardContent className="p-3 md:p-4">
            <div className="flex items-center gap-2">
              <Search className="w-4 h-4" />
              <Input value={query} onChange={e => setQuery(e.target.value)} placeholder="Search pets… (e.g., Raccoon, T-Rex)" className="h-9" />
            </div>
          </CardContent>
        </Card>

        <Card className="md:col-span-7 lg:col-span-6">
          <CardContent className="p-3 md:p-4 grid md:grid-cols-3 gap-4">
            <div className="flex items-center gap-2">
              <Filter className="w-4 h-4" />
              <select value={rarity} onChange={e => setRarity(e.target.value as any)} className="h-9 w-full rounded-xl border px-3">
                {RARITIES.map(r => <option key={r} value={r}>{r}</option>)}
              </select>
            </div>
            <div className="flex items-center gap-3">
              <span className="text-sm whitespace-nowrap">Max placeholder price (R$)</span>
              <div className="flex-1">
                <Slider value={[maxPriceR$]} onValueChange={(v) => setMaxPriceR$(v[0])} min={6} max={15} step={1} />
              </div>
              <span className="text-sm w-10 text-right">{maxPriceR$}</span>
            </div>
            <div className="flex items-center gap-2">
              <span className="text-sm">Sort</span>
              <select value={sort} onChange={e => setSort(e.target.value)} className="h-9 w-full rounded-xl border px-3">
                <option value="price-asc">Price: Low → High</option>
                <option value="price-desc">Price: High → Low</option>
                <option value="name-asc">Name: A → Z</option>
                <option value="name-desc">Name: Z → A</option>
              </select>
            </div>
          </CardContent>
        </Card>
      </section>

      {/* Catalog */}
      <main className="max-w-7xl mx-auto px-4 pb-28">
        <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
          {filtered.map(p => (
            <Card key={p.id} className="group overflow-hidden">
              <CardHeader className="p-0">
                <div className="aspect-square overflow-hidden bg-emerald-100">
                  <img src={p.img} alt={p.name} className="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" />
                </div>
              </CardHeader>
              <CardContent className="p-4">
                <div className="flex items-start justify-between gap-2">
                  <div>
                    <CardTitle className="text-base">{p.name}</CardTitle>
                    <div className="flex items-center gap-2 mt-1">
                      <Badge className="rounded-full" variant="secondary">{p.rarity}</Badge>
                      <Sparkles className="w-3.5 h-3.5" />
                    </div>
                  </div>
                  <div className="text-right shrink-0">
                    <div className="font-semibold leading-tight">{currency === "R$" ? `${p.priceRobux} R$` : formatUsd(p.priceUSD)}</div>
                    <div className="text-xs text-muted-foreground">placeholder</div>
                  </div>
                </div>
                <div className="mt-3 flex items-center gap-2">
                  <Button className="flex-1" onClick={() => addToCart(p.id)}>Add to cart</Button>
                  <Button variant="outline" size="icon" onClick={() => addToCart(p.id)}>
                    <ChevronRight className="w-4 h-4" />
                  </Button>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </main>

      {/* Cart Drawer (simple inline) */}
      <footer className="fixed bottom-0 left-0 right-0 border-t bg-white/90 backdrop-blur">
        <div className="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
          <ShoppingCart className="w-4 h-4" />
          <div className="text-sm flex-1">
            <span className="font-medium">Items:</span> {totalQty} • <span className="font-medium">Total:</span> {currency === "R$" ? `${totalPriceRobux} R$` : formatUsd(totalPriceUSD)} <span className="text-xs text-muted-foreground">(all placeholder)</span>
          </div>
          <Button onClick={checkout}>Checkout (demo)</Button>
          <Button variant="ghost" size="icon" onClick={() => setCart([])} title="Clear cart"><Trash2 className="w-4 h-4" /></Button>
        </div>
      </footer>
    </div>
  );
}
